"""
Aplicaci贸n principal con Streamlit para visualizaci贸n y predicci贸n.
"""

import streamlit as st
import pandas as pd
import numpy as np
from pathlib import Path
import sys

# A帽adir el directorio padre al path
sys.path.insert(0, str(Path(__file__).parent.parent))

from src.utils import setup_logger
from src.data_processing import load_data

logger = setup_logger(__name__)


def main():
    """Funci贸n principal de la aplicaci贸n Streamlit."""
    
    # Configuraci贸n de la p谩gina
    st.set_page_config(
        page_title="ML Forecasting App",
        page_icon="",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # T铆tulo
    st.title(" Machine Learning Forecasting App")
    st.markdown("---")
    
    # Sidebar
    st.sidebar.title(" Men煤")
    menu = st.sidebar.radio(
        "Selecciona una secci贸n:",
        ["Home", "Cargar Datos", "An谩lisis Exploratorio", "Entrenamiento", "Predicci贸n"]
    )
    
    # Home
    if menu == "Home":
        st.header("Bienvenido al Proyecto de Forecasting")
        st.markdown("""
        Esta aplicaci贸n permite:
        -  Cargar y explorar datos
        -  Realizar an谩lisis exploratorio de datos (EDA)
        -  Entrenar modelos de machine learning
        -  Hacer predicciones
        
        ### Caracter铆sticas
        - M煤ltiples modelos disponibles (Regresi贸n Lineal, Random Forest, XGBoost)
        - Normalizaci贸n de datos
        - Ingenier铆a de caracter铆sticas
        - Evaluaci贸n autom谩tica de modelos
        """)
    
    # Cargar Datos
    elif menu == "Cargar Datos":
        st.header(" Cargar Datos")
        
        uploaded_file = st.file_uploader("Elige un archivo CSV", type="csv")
        
        if uploaded_file is not None:
            df = pd.read_csv(uploaded_file)
            st.success("Archivo cargado correctamente!")
            
            st.subheader("Vista Previa de los Datos")
            st.dataframe(df.head(10))
            
            st.subheader("Informaci贸n del Dataset")
            col1, col2, col3 = st.columns(3)
            with col1:
                st.metric("N煤mero de Filas", df.shape[0])
            with col2:
                st.metric("N煤mero de Columnas", df.shape[1])
            with col3:
                st.metric("Valores Faltantes", df.isnull().sum().sum())
            
            # Guardar en sesi贸n
            st.session_state.df = df
            st.info("Datos guardados en sesi贸n. Contin煤a con el siguiente paso.")
    
    # An谩lisis Exploratorio
    elif menu == "An谩lisis Exploratorio":
        st.header(" An谩lisis Exploratorio de Datos")
        
        if 'df' not in st.session_state:
            st.warning("Por favor, carga los datos primero.")
        else:
            df = st.session_state.df
            
            st.subheader("Estad铆sticas Descriptivas")
            st.dataframe(df.describe())
            
            st.subheader("Correlaci贸n entre Variables")
            numeric_cols = df.select_dtypes(include=[np.number]).columns
            if len(numeric_cols) > 1:
                corr_matrix = df[numeric_cols].corr()
                st.dataframe(corr_matrix)
    
    # Entrenamiento
    elif menu == "Entrenamiento":
        st.header(" Entrenamiento de Modelos")
        st.info("Funcionalidad en desarrollo...")
    
    # Predicci贸n
    elif menu == "Predicci贸n":
        st.header(" Predicci贸n")
        st.info("Funcionalidad en desarrollo...")


if __name__ == "__main__":
    main()
